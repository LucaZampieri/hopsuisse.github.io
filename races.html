---
layout: page
title: Races
permalink: /races/
---

<div id="searchfield">
  <h3>Search for a race :</h3>
  <form>
    <input type="text" name="race" class="biginput" id="autocomplete"
    value="Type a location or a name here..." 
    onblur="if (this.value==''){this.value='Type a location or a name here...';}"
    onfocus="if (this.value!=''){this.value='';}">
  </form>
</div>

<div id="outputbox">
  <p id="outputcontent">Choose a race and the results will display here.</p>
</div>

<div id="map"></div>
<div id="chart"></div>

<script type="text/javascript">
  var mymap = null;
</script>
<script type="text/javascript">
$(function(){
  var races = [
    {% for id in site.data.races %}
    {value: "{{ id[1]["race"]}} ({{ id[1]["date"] }})", data: {{ id[1] | jsonify }}},
    {% endfor %}
  ];
  $('#autocomplete').autocomplete({
    lookup: races,
    onSelect: function (suggestion) {
      // Display map
      var latitude = suggestion.data.latitude;
      var longitude = suggestion.data.longitude;
      if (mymap == null) {
        $("#map").height(250);
        if (latitude!=null && longitude!=null) {
            mymap = L.map('map').setView([latitude,longitude], 10);
        }
      } else {
        if (latitude!=null && longitude!=null) {
            mymap.setView([latitude,longitude], 10);
        } else {
          // hide the map
          $("#map").height(0);
          mymap = null;
        }
      }
      var Stamen_Terrain = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.{ext}', {
        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
	      subdomains: 'abcd',
	      minZoom: 0,
	      maxZoom: 18,
	      ext: 'png'
      }).addTo(mymap);
      // Create a simple bar plot
      var chart = c3.generate({
          bindto: '#chart',
          data: {
            columns: [
              ['count', suggestion.data.M, suggestion.data.F]
            ],
            type: 'bar'
          },
          axis: {
            x: {
              type: 'category',
              categories: ['male', 'female']
            }
          }
      });
      // Display basic info
      var thehtml = 
        '<strong>Race:</strong> ' + suggestion.data.race + '<br/>' +
        '<strong>Date:</strong> ' + suggestion.data.date + '<br/>' +
        '<strong>Participants:</strong> ' + suggestion.data.count + '<br/>' +
        '<strong>Men:</strong> ' + suggestion.data.M + '<br/>' +
        '<strong>Women:</strong> ' + suggestion.data.F + '<br/>';
      $('#outputcontent').html(thehtml);
    }
  });
});
</script>

